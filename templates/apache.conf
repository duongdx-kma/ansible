<VirtualHost *:80>
    # ServerAdmin admin@web1.com
    ServerName {{ domain_name }}
    ServerAlias {{ domain_name }}

    # Turn on rewrite engine
    RewriteEngine On

    # RewriteRule for /portainer
    RewriteCond %{HTTP_HOST} ^{{ domain_name }} [NC]
    RewriteRule ^/portainer(.*)$ http://localhost:9000$1 [P,L]

    # RewriteRule for /api
    RewriteCond %{HTTP_HOST} ^{{ domain_name }} [NC]
    RewriteRule ^/api(.*)$ http://localhost:{{ app_port }}$1 [P,L]

    ProxyPreserveHost On
    ProxyErrorOverride On

    ProxyPassReverse /api http://localhost:{{ app_port }}/
    ProxyPassReverse /portainer http://localhost:9000/

    DocumentRoot /var/www/{{ domain_name }}
    DirectoryIndex index.php index.html
</VirtualHost>
